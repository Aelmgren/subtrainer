/*! videojs-transcript - v0.0.0 - 2014-10-06
* Copyright (c) 2014 Matthew Walsh; Licensed MIT */
!function(a,b){"use strict";!function(){for(var b=0,c=["ms","moz","webkit","o"],d=0;d<c.length&&!a.requestAnimationFrame;++d)a.requestAnimationFrame=a[c[d]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[c[d]+"CancelAnimationFrame"]||a[c[d]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(c){var d=(new Date).getTime(),e=Math.max(0,16-(d-b)),f=a.setTimeout(function(){c(d+e)},e);return b=d+e,f}),a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)})}(),"function"!=typeof Object.create&&(Object.create=function(){var a=function(){};return function(b){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof b)throw TypeError("Argument must be an object");a.prototype=b;var c=new a;return a.prototype=null,c}}()),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}});var c={};c.settings={},c.prefix="transcript",c.player=this;var d={autoscroll:!0,clickArea:"line"},e=function(a){return{secondsToTime:function(a){var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%60);return d=10>d?"0"+d:d,c=b>0&&10>c?"0"+c:c,b>0?b+":"+c+":"+d:c+":"+d},localize:function(a){return a},createEl:function(b,c){c=c||"";var d=document.createElement(b);return d.className=a.prefix+c,d},extend:function(a){var b=typeof a;if(!("function"===b||"object"===b&&a))return a;for(var c,d,e=1,f=arguments.length;f>e;e++){c=arguments[e];for(d in c)a[d]=c[d]}return a}}}(c),f={handlers_:[],on:function(a,b,c){if("function"!=typeof c)throw new TypeError("Callback is not a function.");this.handlers_.push([a,b,c])},trigger:function(a,b){this.handlers_.forEach(function(c){c[0]===a&&c[1]===b&&c[2].apply()})},delegate:function(a){return a.on=function(b,c){f.on(a,b,c)},a.trigger=function(a){f.trigget(a,event)},a}},g=function(){var a=function(a){a.addEventListener("scroll",function(){this.isAutoScrolling?this.isAutoScrolling=!1:(this.userIsScrolling=!0,a.classList.add("is-inuse"))}),a.addEventListener("mouseover",function(){this.mouseIsOverTranscript=!0}),a.addEventListener("mouseout",function(){this.mouseIsOverTranscript=!1,setTimeout(function(){this.mouseIsOverTranscript||(this.userIsScrolling=!1,a.classList.remove("is-inuse"))},1e3)})},b=function(b){return this.element=b,this.userIsScrolling=!1,this.mouseIsOver=!1,this.isAutoScrolling=!0,a(this.element),this},c=function(a,b,c,d){return b+c*Math.sin(Math.min(1,a/d)*(Math.PI/2))},d=function(a,b,d){var e=Date.now(),f=a.scrollTop;b=Math.max(0,b),b=Math.min(a.scrollHeight-a.clientHeight,b);var g=b-f,h=function(){var i=Date.now(),j=i-e;this.isAutoScrolling=!0,a.scrollTop=c(j,f,g,d),a.scrollTop!==b&&requestAnimationFrame(h,a)};requestAnimationFrame(h,a)},e=function(a){var b,c=a.parentElement,e=c.offsetTop+c.clientHeight,f=a.offsetTop+a.clientHeight,g=a.offsetTop+a.clientHeight-c.offsetTop;g<c.scrollTop?b=a.offsetTop-c.offsetTop:g>c.scrollTop+c.clientHeight&&(b=f-e),void 0!==b&&c.scrollTop!==b&&d(c,b,400)},f=function(){var a=this.element;return a.scrollHeight>a.offsetHeight},g=function(){return this.userIsScrolling};return{init:b,to:e,canScroll:f,inUse:g}}(c),h=function(a){return Object.create(g).init(a)},i=function(){var a;return{get:function(){var a=[];return c.tracks=c.player.textTracks(),c.tracks.forEach(function(b){("captions"===b.kind()||"subtitles"===b.kind())&&a.push(b)}),a},active:function(b){return b.forEach(function(b){return 2===b.mode()?(a=b,b):void 0}),a||b[0]}}}(c),j=function(a){var b={};b.element={},b.body={};var c=function(a,b){f.on(this,a,b)},d=function(a){f.trigger(this,a)},g=function(){var a=e.createEl("header","-header");return a.textContent=e.localize("Transcript"),a},i=function(){var b=e.createEl("select","-selector");return a.validTracks.forEach(function(a,c){var d=document.createElement("option");d.value=c,d.textContent=a.label()+" ("+a.language()+")",b.appendChild(d)}),b.addEventListener("change",function(){m(document.querySelector("#"+a.prefix+"-"+a.player.id()+" option:checked").value),d("trackchanged")}),b},j=function(a){var b=e.createEl("div","-line"),c=e.createEl("span","-timestamp"),d=e.createEl("span","-text");return b.setAttribute("data-begin",a.startTime),c.textContent=e.secondsToTime(a.startTime),d.innerHTML=a.text,b.appendChild(c),b.appendChild(d),b},k=function(b){"object"!=typeof b&&(b=a.player.textTracks()[b]);var c,d,f=e.createEl("div","-body"),g=document.createDocumentFragment(),i=function(){var a=b.cues();for(d=0;d<a.length;d++)c=j(a[d]),g.appendChild(c);f.innerHTML="",f.appendChild(g),f.setAttribute("lang",b.language())};return 2!==b.readyState()?(b.load(),b.on("loaded",i)):i(),f.scroll=h(f),console.log(h(f)),f},l=function(){var c=document.createElement("div");b.element=c,c.setAttribute("id",a.prefix+"-"+a.player.id());var d=g();c.appendChild(d);var f=i();return c.appendChild(f),b.body=e.createEl("div","-body"),c.appendChild(b.body),m(a.currentTrack),this},m=function(a){var c=k(a);b.element.replaceChild(c,b.body),b.body=c},n=function(c){var d,e,f,g,h=b.body.children;for(d=0;d<h.length;d++)e=h[d],f=e.getAttribute("data-begin"),g=d<h.length-1?h[d+1].getAttribute("data-begin"):a.player.duration()||1/0,c>f&&g>c?e.classList.contains("is-active")||(e.classList.add("is-active"),a.settings.autoscroll&&b.body.scroll.canScroll()&&!b.body.scroll.inUse()&&b.body.scroll.to(e)):e.classList.remove("is-active")},o=function(){return b.element};return{create:l,setTrack:m,setCue:n,el:o,on:c,trigger:d}}(c),k=function(a){c.player=this,c.validTracks=i.get(),c.currentTrack=i.active(c.validTracks),c.settings=b.util.mergeOptions(d,a),c.widget=j.create();var e=function(){c.widget.setCue(c.player.currentTime())},f=function(){c.currentTrack=i.active(c.validTracks),c.widget.setTrack(c.currentTrack)};if(!(c.validTracks.length>0))throw new Error("videojs-transcript: No tracks found!");return f(),c.player.on("timeupdate",e),c.player.on("captionstrackchange",f),c.player.on("subtitlestrackchange",f),{el:function(){return c.widget.el()},setTrack:c.widget.setTrack}};b.plugin("transcript",k)}(window,videojs);