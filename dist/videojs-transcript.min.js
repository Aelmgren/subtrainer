/*! videojs-transcript - v0.0.0 - 2014-09-20
* Copyright (c) 2014 Matthew Walsh; Licensed MIT */
!function(a,b){"use strict";var c=function(){var a=function(a){var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%60);return d=10>d?"0"+d:d,c=b>0&&10>c?"0"+c:c,b>0?b+":"+c+":"+d:c+":"+d};return{niceTimestamp:a}}(),d=function(){var a,b,d,e,f,g=function(a){var b=document.createElement("div"),d=document.createElement("span"),f=document.createElement("span");return b.className=e+"-line",b.setAttribute("data-begin",a.startTime),d.className=e+"-timestamp",d.textContent=c.niceTimestamp(a.startTime),f.className=e+"-text",f.innerHTML=a.text,b.appendChild(d),b.appendChild(f),b},h=function(a){if("object"!=typeof a&&(a=d.textTracks()[a]),void 0===b)throw new Error("videojs-transcript: Html not initialized!");var c,h,i=document.createDocumentFragment(),j=function(){var d=a.cues();for(h=0;h<d.length;h++)c=g(d[h],e),i.appendChild(c);b.innerHTML="",b.appendChild(i),b.setAttribute("lang",a.language())};b.addEventListener("click",function(a){var b=a.target.classList,c=a.target.getAttribute("data-begin")||a.target.parentElement.getAttribute("data-begin");void 0!==c&&null!==c&&("line"===f.clickArea||"timestamp"===f.clickArea&&b.contains(e+"-timestamp")||"text"===f.clickArea&&b.contains(e+"-text"))&&d.currentTime(c)}),2!==a.readyState()?(a.load(),a.on("loaded",j)):j()},i=function(a){var b,c,f,g=document.createElement("select");for(b=0;b<a.length;b++)c=a[b],f=document.createElement("option"),f.value=b,f.textContent=c.label()+" ("+c.language()+")",g.appendChild(f);return g.addEventListener("change",function(){h(document.querySelector("#"+e+"-"+d.id()+" option:checked").value)}),g},j=function(c,g,h,j){a=c,d=g,e=h,b=document.createElement("div"),f=j.options,a.className=h,b.className=h+"-lines",a.id=e+"-"+d.id(),a.appendChild(i(d.textTracks())),a.appendChild(b)};return{init:j,setTrack:h}}(),e=function(){var b=!1,c=!1,d=!0,e=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)},f=function(a,b,c,d){return b+c*Math.sin(Math.min(1,a/d)*(Math.PI/2))},g=function(a,b,c){var g=Date.now(),h=a.scrollTop;b=Math.max(0,b),b=Math.min(a.scrollHeight-a.clientHeight,b);var i=b-h,j=function(){var k=Date.now(),l=k-g;d=!0,a.scrollTop=f(l,h,i,c),a.scrollTop!==b&&e(j,a)};e(j,a)},h=function(a){var b,c=a.parentElement,d=c.offsetTop+c.clientHeight,e=a.offsetTop+a.clientHeight,f=a.offsetTop+a.clientHeight-c.offsetTop;f<c.scrollTop?b=a.offsetTop-c.offsetTop:f>c.scrollTop+c.clientHeight&&(b=e-d),void 0!==b&&c.scrollTop!==b&&g(c,b,400)},i=function(a){a.addEventListener("scroll",function(){d?d=!1:(b=!0,a.classList.add("is-inuse"))}),a.addEventListener("mouseover",function(){c=!0}),a.addEventListener("mouseout",function(){c=!1,setTimeout(function(){c||(b=!1,a.classList.remove("is-inuse"))},1e3)})},j=function(a){return a.scrollHeight>a.offsetHeight},k=function(){return b};return{scrollToElement:h,initHandlers:i,inUse:k,canScroll:j}}(),f=function(a,b){var c={autoscroll:!0,clickArea:"line"},f=function(a){var f,g,h=b.util.mergeOptions(c,a),i=this,j="transcript",k=document.createElement("div"),l=function(){var a,b,c=[];for(f=i.textTracks(),a=0;a<f.length;a++)b=f[a].kind(),("captions"===b||"subtitles"===b)&&c.push(f[a]);return c},m=function(a){var b;for(b=0;b<a.length;b++)if(2===a[b].mode())return a[b];return g||a[0]},n=function(){var a,b,c,d=document.querySelectorAll("#"+k.id+" > ."+j+"-line"),e=[];for(a=0;a<d.length;a++)b=d[a],c={element:b,begin:b.getAttribute("data-begin")},e.push(c);return e},o=function(){var a,b,c,d=i.currentTime(),f=n();for(c=0;c<f.length;c++)a=f[c],b=c<f.length-1?f[c+1].begin:i.duration()||1/0,d>a.begin&&b>d?a.element.classList.contains("is-active")||(a.element.classList.add("is-active"),h.autoscroll&&e.canScroll(k)&&!e.inUse()&&e.scrollToElement(a.element)):a.element.classList.remove("is-active")},p=function(){g=m(f),d.setTrack(g)};if(f=l(),!(f.length>0))throw new Error("videojs-transcript: No tracks found!");d.init(k,i,j,this),e.initHandlers(k),p(),i.on("timeupdate",o),i.on("captionstrackchange",p),i.on("subtitlestrackchange",p);var q=function(){return k};return{el:q,setTrack:p,options:a}};return{transcript:f}}(a,b);b.plugin("transcript",f.transcript)}(window,window.videojs);